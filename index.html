<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMLOXA VISUALIZER</title>
    <style>
        :root {
            --primary-rgb: 0, 255, 0;
            --wave-scale: 3;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(90deg, 
                rgba(255,0,0,0.3) 0%, 
                rgba(0,255,0,0.3) 50%, 
                rgba(0,0,255,0.3) 100%);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        
        h1 {
            font-size: 4rem;
            margin-bottom: 15px;
            background: linear-gradient(90deg, #ff0000, #00ff00, #0000ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 50px rgba(255, 255, 255, 0.4);
            font-weight: 900;
            letter-spacing: 3px;
            text-transform: uppercase;
        }
        
        .subtitle {
            font-size: 1.3rem;
            color: #94a3b8;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.8;
        }
        
        .content {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 30px;
        }
        
        @media (max-width: 1200px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
        
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .panel-section {
            background: rgba(0, 0, 0, 0.85);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .section-title {
            font-size: 1.3rem;
            color: #fff;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 15px;
            border-bottom: 3px solid rgba(255, 255, 255, 0.2);
        }
        
        .upload-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .upload-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            cursor: pointer;
            padding: 30px 25px;
            border: 3px dashed rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: rgba(255, 255, 255, 0.05);
        }
        
        .upload-box:hover {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.15);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 25px rgba(0, 255, 0, 0.2);
        }
        
        .upload-icon {
            font-size: 3rem;
            background: linear-gradient(90deg, #ff0000, #00ff00, #0000ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .upload-text h4 {
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 8px;
        }
        
        .upload-text p {
            color: #94a3b8;
            font-size: 0.95rem;
            text-align: center;
        }
        
        #audioUpload, #imageUpload, #backgroundUpload {
            display: none;
        }
        
        .file-info {
            padding: 20px;
            background: rgba(255, 255, 255, 0.07);
            border-radius: 12px;
            display: none;
            border-left: 5px solid #00ff00;
            animation: slideIn 0.5s ease;
        }
        
        .file-info.active {
            display: block;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .info-title {
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-detail {
            color: #94a3b8;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .control-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .control-btn {
            background: linear-gradient(135deg, 
                rgba(255,0,0,0.8), 
                rgba(0,255,0,0.8));
            color: white;
            border: none;
            border-radius: 15px;
            padding: 18px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .control-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.3), 
                transparent);
            transition: 0.5s;
        }
        
        .control-btn:hover:not(:disabled) {
            transform: translateY(-5px) scale(1.05);
            background: linear-gradient(135deg, 
                rgba(255,0,0,1), 
                rgba(0,255,0,1));
            box-shadow: 0 10px 25px rgba(0, 255, 0, 0.4);
        }
        
        .control-btn:hover:not(:disabled)::before {
            left: 100%;
        }
        
        .control-btn:disabled {
            background: #2d3748;
            cursor: not-allowed;
            transform: none;
            opacity: 0.5;
        }
        
        .download-btn {
            background: linear-gradient(135deg, 
                rgba(0,255,0,0.8), 
                rgba(0,0,255,0.8));
            grid-column: span 3;
        }
        
        .download-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, 
                rgba(0,255,0,1), 
                rgba(0,0,255,1));
            box-shadow: 0 10px 25px rgba(0, 0, 255, 0.4);
        }
        
        .settings {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .setting-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .setting-label {
            font-size: 1.1rem;
            color: #e2e8f0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }
        
        .wave-mode-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .wave-mode-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 3px solid rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
            border-radius: 15px;
            padding: 20px 15px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: center;
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .wave-mode-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                rgba(255,255,255,0.1), 
                transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .wave-mode-btn:hover::before {
            opacity: 1;
        }
        
        .wave-mode-btn.active {
            background: linear-gradient(135deg, #ff0000, #00ff00, #0000ff);
            border-color: transparent;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .mode-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .rgb-controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 15px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .rgb-slider {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .rgb-slider label {
            min-width: 70px;
            color: #fff;
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .rgb-slider input {
            flex: 1;
            height: 10px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            outline: none;
        }
        
        .rgb-slider input::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
        .rgb-slider input::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
        #redSlider::-webkit-slider-thumb { background: #ff0000; }
        #greenSlider::-webkit-slider-thumb { background: #00ff00; }
        #blueSlider::-webkit-slider-thumb { background: #0000ff; }
        
        #redSlider::-moz-range-thumb { background: #ff0000; }
        #greenSlider::-moz-range-thumb { background: #00ff00; }
        #blueSlider::-moz-range-thumb { background: #0000ff; }
        
        .rgb-value {
            min-width: 40px;
            text-align: center;
            font-weight: 800;
            font-size: 1.2rem;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .rgb-preview {
            width: 100%;
            height: 50px;
            border-radius: 12px;
            margin-top: 15px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }
        
        .wave-scale-control {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
        }
        
        .scale-value {
            font-size: 1.3rem;
            font-weight: 800;
            color: #00ff00;
            min-width: 60px;
            text-align: center;
            padding: 10px;
            background: rgba(0, 255, 0, 0.1);
            border-radius: 10px;
        }
        
        #waveScaleSlider {
            flex: 1;
            height: 12px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(90deg, #ff0000, #00ff00, #0000ff);
            border-radius: 10px;
            outline: none;
        }
        
        #waveScaleSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            border: 3px solid #000;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.8);
        }
        
        .visualizer-section {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .visualizer-container {
            background: rgba(0, 0, 0, 0.9);
            border-radius: 25px;
            padding: 30px;
            border: 3px solid rgba(255, 255, 255, 0.15);
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            min-height: 700px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5);
        }
        
        .visualizer-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, 
                rgba(255,0,0,0.1) 0%, 
                rgba(0,255,0,0.1) 50%, 
                rgba(0,0,255,0.1) 100%);
            opacity: 0.3;
            pointer-events: none;
        }
        
        #visualizerCanvas {
            display: block;
            border-radius: 15px;
            width: 100% !important;
            height: 650px !important;
            background: transparent;
        }
        
        .center-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 220px;
            height: 220px;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid rgba(255, 255, 255, 0.4);
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 0 40px rgba(255, 0, 0, 0.5),
                0 0 80px rgba(0, 255, 0, 0.3),
                0 0 120px rgba(0, 0, 255, 0.2);
        }
        
        #centerImage {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
        }
        
        .default-circle {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, 
                rgba(255,0,0,0.3), 
                rgba(0,255,0,0.3), 
                rgba(0,0,255,0.3));
            color: rgba(255, 255, 255, 0.9);
            text-align: center;
            padding: 20px;
            font-size: 0.9rem;
        }
        
        .default-circle i {
            font-size: 3.5rem;
            margin-bottom: 15px;
            display: block;
        }
        
        .recording-indicator {
            position: absolute;
            top: 25px;
            right: 25px;
            background: linear-gradient(135deg, 
                #ef4444, 
                #dc2626, 
                #b91c1c);
            color: white;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 700;
            display: none;
            align-items: center;
            gap: 15px;
            z-index: 100;
            box-shadow: 0 5px 20px rgba(239, 68, 68, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .recording-indicator.active {
            display: flex;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { 
                opacity: 0.9; 
                transform: scale(1); 
                box-shadow: 0 5px 20px rgba(239, 68, 68, 0.5);
            }
            50% { 
                opacity: 1; 
                transform: scale(1.05); 
                box-shadow: 0 8px 30px rgba(239, 68, 68, 0.8);
            }
        }
        
        .loading {
            text-align: center;
            color: #00ff00;
            font-size: 1.1rem;
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 30px;
        }
        
        .loading.active {
            display: flex;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(0, 255, 0, 0.2);
            border-top: 4px solid #00ff00;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .quality-badge {
            position: absolute;
            top: 25px;
            left: 25px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 100;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .visualizer-stats {
            position: absolute;
            bottom: 25px;
            left: 25px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            display: none;
            flex-direction: column;
            gap: 8px;
            z-index: 100;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .visualizer-stats.active {
            display: flex;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stat-value {
            color: #00ff00;
            font-weight: 700;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 25px;
            color: #94a3b8;
            font-size: 0.95rem;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-wave-square"></i> EMLOXA VISUALIZER</h1>
            <p class="subtitle">Profesyonel ses görselleştirici • 1440p 60FPS video kaydı • 7 farklı dalga modu • RGB kontrol</p>
        </header>
        
        <div class="content">
            <div class="left-panel">
                <!-- Dosya Yükleme -->
                <div class="panel-section">
                    <h3 class="section-title"><i class="fas fa-file-upload"></i> Dosya Yükleme</h3>
                    <div class="upload-area">
                        <label for="audioUpload" class="upload-box">
                            <div class="upload-icon">
                                <i class="fas fa-music"></i>
                            </div>
                            <div class="upload-text">
                                <h4>Ses Dosyası</h4>
                                <p>MP3, WAV, OGG formatları</p>
                            </div>
                        </label>
                        <input type="file" id="audioUpload" accept="audio/*">
                        
                        <div class="file-info" id="audioInfo">
                            <div class="info-title">
                                <i class="fas fa-file-audio"></i>
                                <span id="audioTitle">Ses dosyası bekleniyor</span>
                            </div>
                            <div class="info-detail">
                                <i class="far fa-clock"></i>
                                <span id="audioDuration">Dosya seçin veya sürükleyin</span>
                            </div>
                        </div>
                        
                        <label for="imageUpload" class="upload-box">
                            <div class="upload-icon">
                                <i class="fas fa-image"></i>
                            </div>
                            <div class="upload-text">
                                <h4>Merkez Görsel</h4>
                                <p>Zorunlu - daire içinde görünür</p>
                            </div>
                        </label>
                        <input type="file" id="imageUpload" accept="image/*" required>
                        
                        <div class="file-info" id="imageInfo">
                            <div class="info-title">
                                <i class="fas fa-image"></i>
                                <span id="imageTitle">Merkez görsel gerekli</span>
                            </div>
                            <div class="info-detail">
                                <i class="fas fa-ruler-combined"></i>
                                <span id="imageSize">Lütfen bir görsel seçin</span>
                            </div>
                        </div>
                        
                        <label for="backgroundUpload" class="upload-box">
                            <div class="upload-icon">
                                <i class="fas fa-landscape"></i>
                            </div>
                            <div class="upload-text">
                                <h4>Arkaplan Görseli</h4>
                                <p>Zorunlu - görselleştirici arkaplanı</p>
                            </div>
                        </label>
                        <input type="file" id="backgroundUpload" accept="image/*" required>
                        
                        <div class="file-info" id="backgroundInfo">
                            <div class="info-title">
                                <i class="fas fa-landscape"></i>
                                <span id="backgroundTitle">Arkaplan gerekli</span>
                            </div>
                            <div class="info-detail">
                                <i class="fas fa-info-circle"></i>
                                <span>Lütfen bir arkaplan seçin</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="loading" id="loading">
                        <div class="spinner"></div>
                        <div>Yüksek kalitede işleniyor...</div>
                    </div>
                </div>
                
                <!-- Kontroller -->
                <div class="panel-section">
                    <h3 class="section-title"><i class="fas fa-sliders-h"></i> Kontroller</h3>
                    <div class="controls">
                        <div class="control-buttons">
                            <button id="playBtn" class="control-btn" disabled>
                                <i class="fas fa-play"></i> Oynat
                            </button>
                            <button id="pauseBtn" class="control-btn" disabled>
                                <i class="fas fa-pause"></i> Duraklat
                            </button>
                            <button id="stopBtn" class="control-btn" disabled>
                                <i class="fas fa-stop"></i> Durdur
                            </button>
                            <button id="downloadBtn" class="control-btn download-btn" disabled>
                                <i class="fas fa-video"></i> 1440p Kaydet
                            </button>
                        </div>
                        
                        <div class="wave-scale-control">
                            <label class="setting-label">
                                <i class="fas fa-expand-alt"></i> Dalga Boyutu
                            </label>
                            <input type="range" id="waveScaleSlider" min="1" max="10" step="0.1" value="3">
                            <div class="scale-value" id="scaleValue">3x</div>
                        </div>
                        
                        <div class="setting-group">
                            <label class="setting-label">
                                <i class="fas fa-volume-up"></i> Ses Seviyesi
                            </label>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <input type="range" id="volumeSlider" min="0" max="100" value="70" style="flex: 1;">
                                <span id="volumeValue" style="color: #00ff00; font-weight: 800; min-width: 50px; font-size: 1.2rem; background: rgba(0,255,0,0.1); padding: 8px 12px; border-radius: 10px;">70%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Ayarlar -->
                <div class="panel-section">
                    <h3 class="section-title"><i class="fas fa-magic"></i> Dalga Modları</h3>
                    <div class="settings">
                        <div class="wave-mode-selector">
                            <button class="wave-mode-btn active" data-mode="rgb">
                                <div class="mode-icon">
                                    <i class="fas fa-palette"></i>
                                </div>
                                <div>RGB Spectrum</div>
                            </button>
                            <button class="wave-mode-btn" data-mode="fire">
                                <div class="mode-icon">
                                    <i class="fas fa-fire"></i>
                                </div>
                                <div>Ateş Dalgası</div>
                            </button>
                            <button class="wave-mode-btn" data-mode="nebula">
                                <div class="mode-icon">
                                    <i class="fas fa-stars"></i>
                                </div>
                                <div>Nebula</div>
                            </button>
                            <button class="wave-mode-btn" data-mode="hologram">
                                <div class="mode-icon">
                                    <i class="fas fa-atom"></i>
                                </div>
                                <div>Hologram</div>
                            </button>
                            <button class="wave-mode-btn" data-mode="pulse">
                                <div class="mode-icon">
                                    <i class="fas fa-heartbeat"></i>
                                </div>
                                <div>Kalp Atışı</div>
                            </button>
                            <button class="wave-mode-btn" data-mode="cyber">
                                <div class="mode-icon">
                                    <i class="fas fa-microchip"></i>
                                </div>
                                <div>Cyberpunk</div>
                            </button>
                            <button class="wave-mode-btn" data-mode="liquid">
                                <div class="mode-icon">
                                    <i class="fas fa-water"></i>
                                </div>
                                <div>Sıvı Metal</div>
                            </button>
                            <button class="wave-mode-btn" data-mode="energy">
                                <div class="mode-icon">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <div>Enerji Alanı</div>
                            </button>
                        </div>
                        
                        <div class="setting-group">
                            <label class="setting-label">RGB Renk Kontrolleri</label>
                            <div class="rgb-controls">
                                <div class="rgb-slider">
                                    <label style="color: #ff0000; text-shadow: 0 0 10px #ff0000;">KIRMIZI:</label>
                                    <input type="range" id="redSlider" min="0" max="255" value="255">
                                    <span id="redValue" class="rgb-value" style="color: #ff0000; text-shadow: 0 0 10px #ff0000;">255</span>
                                </div>
                                <div class="rgb-slider">
                                    <label style="color: #00ff00; text-shadow: 0 0 10px #00ff00;">YEŞİL:</label>
                                    <input type="range" id="greenSlider" min="0" max="255" value="0">
                                    <span id="greenValue" class="rgb-value" style="color: #00ff00; text-shadow: 0 0 10px #00ff00;">0</span>
                                </div>
                                <div class="rgb-slider">
                                    <label style="color: #0000ff; text-shadow: 0 0 10px #0000ff;">MAVİ:</label>
                                    <input type="range" id="blueSlider" min="0" max="255" value="255">
                                    <span id="blueValue" class="rgb-value" style="color: #0000ff; text-shadow: 0 0 10px #0000ff;">255</span>
                                </div>
                                <div class="rgb-preview" id="rgbPreview"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Görselleştirici -->
            <div class="visualizer-section">
                <div class="visualizer-container">
                    <div class="quality-badge">
                        <i class="fas fa-hd"></i> 1440p • 60FPS
                    </div>
                    <div class="recording-indicator" id="recordingIndicator">
                        <i class="fas fa-circle"></i> 1440p KAYIT AKTİF
                    </div>
                    <div class="visualizer-stats" id="visualizerStats">
                        <div class="stat-item">
                            <i class="fas fa-wave-square"></i>
                            <span>Mod:</span>
                            <span class="stat-value" id="currentMode">RGB</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-ruler"></i>
                            <span>Dalga:</span>
                            <span class="stat-value" id="currentScale">3x</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>BPM:</span>
                            <span class="stat-value" id="currentBPM">120</span>
                        </div>
                    </div>
                    <canvas id="visualizerCanvas"></canvas>
                    <div class="center-circle" id="centerCircle">
                        <img id="centerImage" alt="Merkez Görsel">
                        <div class="default-circle" id="defaultCircle">
                            <i class="fas fa-user-circle"></i>
                            <div>Görsel Yükleyin</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>© 2024 EMLOXA VISUALIZER | Profesyonel Ses Görselleştirme Sistemi • Tüm hakları saklıdır</p>
        </footer>
    </div>

    <script>
        // ==================== GELİŞMİŞ SES GÖRSELLEŞTİRİCİ ====================
        
        // DOM Elementleri
        const audioUpload = document.getElementById('audioUpload');
        const audioInfo = document.getElementById('audioInfo');
        const audioTitle = document.getElementById('audioTitle');
        const audioDuration = document.getElementById('audioDuration');
        
        const imageUpload = document.getElementById('imageUpload');
        const imageInfo = document.getElementById('imageInfo');
        const imageTitle = document.getElementById('imageTitle');
        const imageSize = document.getElementById('imageSize');
        
        const backgroundUpload = document.getElementById('backgroundUpload');
        const backgroundInfo = document.getElementById('backgroundInfo');
        const backgroundTitle = document.getElementById('backgroundTitle');
        
        const loading = document.getElementById('loading');
        const playBtn = document.getElementById('playBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const stopBtn = document.getElementById('stopBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeValue = document.getElementById('volumeValue');
        const canvas = document.getElementById('visualizerCanvas');
        const centerCircle = document.getElementById('centerCircle');
        const centerImage = document.getElementById('centerImage');
        const defaultCircle = document.getElementById('defaultCircle');
        const recordingIndicator = document.getElementById('recordingIndicator');
        const visualizerStats = document.getElementById('visualizerStats');
        const currentMode = document.getElementById('currentMode');
        const currentScale = document.getElementById('currentScale');
        const currentBPM = document.getElementById('currentBPM');
        
        // RGB Kontrolleri
        const redSlider = document.getElementById('redSlider');
        const greenSlider = document.getElementById('greenSlider');
        const blueSlider = document.getElementById('blueSlider');
        const redValue = document.getElementById('redValue');
        const greenValue = document.getElementById('greenValue');
        const blueValue = document.getElementById('blueValue');
        const rgbPreview = document.getElementById('rgbPreview');
        const waveScaleSlider = document.getElementById('waveScaleSlider');
        const scaleValue = document.getElementById('scaleValue');
        
        const waveModeBtns = document.querySelectorAll('.wave-mode-btn');
        
        // Canvas Context
        const ctx = canvas.getContext('2d', { alpha: true, desynchronized: false });
        
        // Audio System
        let audioContext = null;
        let audioSource = null;
        let analyser = null;
        let dataArray = null;
        let timeArray = null;
        let bufferLength = null;
        
        // Audio Element
        const audioElement = new Audio();
        audioElement.crossOrigin = "anonymous";
        let isPlaying = false;
        let currentAudioUrl = null;
        let currentImage = null;
        let backgroundImage = null;
        
        // Visualization Settings
        let waveMode = 'rgb';
        let redColor = 255;
        let greenColor = 0;
        let blueColor = 255;
        let waveScale = 3.0;
        let isRecording = false;
        let mediaRecorder = null;
        let videoChunks = [];
        let stream = null;
        let videoCanvas = null;
        let videoCtx = null;
        
        // Animation
        let animationId = null;
        let wavePoints = [];
        let extraPoints = [];
        const barsCount = 400; // Yüksek çözünürlük için artırıldı
        
        // Merkez daire büyüme için
        let circleScale = 1;
        let targetCircleScale = 1;
        
        // BPM Detection
        let bpm = 120;
        let beatTimes = [];
        let lastBeat = 0;
        
        // Particle System
        let particles = [];
        let fireParticles = [];
        let nebulaParticles = [];
        
        // RGB preview'i güncelle
        function updateRGBPreview() {
            rgbPreview.style.background = `rgb(${redColor}, ${greenColor}, ${blueColor})`;
            rgbPreview.style.boxShadow = `0 0 30px rgba(${redColor}, ${greenColor}, ${blueColor}, 0.5)`;
        }
        
        // Canvas Setup - 1440p için optimize
        function setupCanvas() {
            const container = canvas.parentElement;
            const containerWidth = container.clientWidth - 60;
            const containerHeight = 650;
            
            // 1440p kalitesi için yüksek DPI
            const dpi = window.devicePixelRatio || 1;
            const targetWidth = 2560;
            const targetHeight = 1440;
            
            canvas.style.width = containerWidth + 'px';
            canvas.style.height = containerHeight + 'px';
            
            // Yüksek çözünürlüklü canvas
            canvas.width = Math.min(containerWidth, targetWidth) * dpi * 1.5;
            canvas.height = Math.min(containerHeight, targetHeight) * dpi * 1.5;
            
            ctx.scale(dpi * 1.5, dpi * 1.5);
            
            // Video kaydı için ayrı canvas
            if (!videoCanvas) {
                videoCanvas = document.createElement('canvas');
                videoCtx = videoCanvas.getContext('2d');
                videoCanvas.width = 2560;
                videoCanvas.height = 1440;
            }
            
            visualizerStats.classList.add('active');
        }
        
        // Initialize
        window.addEventListener('load', () => {
            setupCanvas();
            initWavePoints();
            initParticleSystems();
            audioInfo.classList.add('active');
            imageInfo.classList.add('active');
            backgroundInfo.classList.add('active');
            
            // RGB slider event listeners
            redSlider.addEventListener('input', (e) => {
                redColor = parseInt(e.target.value);
                redValue.textContent = redColor;
                updateRGBPreview();
            });
            
            greenSlider.addEventListener('input', (e) => {
                greenColor = parseInt(e.target.value);
                greenValue.textContent = greenColor;
                updateRGBPreview();
            });
            
            blueSlider.addEventListener('input', (e) => {
                blueColor = parseInt(e.target.value);
                blueValue.textContent = blueColor;
                updateRGBPreview();
            });
            
            // Wave scale slider
            waveScaleSlider.addEventListener('input', (e) => {
                waveScale = parseFloat(e.target.value);
                scaleValue.textContent = waveScale.toFixed(1) + 'x';
                currentScale.textContent = waveScale.toFixed(1) + 'x';
            });
            
            updateRGBPreview();
            
            // Wave mode event listeners
            waveModeBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    waveModeBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    waveMode = btn.dataset.mode;
                    currentMode.textContent = btn.textContent.trim();
                    
                    if (analyser) {
                        updateAnalyserSettings();
                    }
                });
            });
            
            // Video kaydı için orijinal boyutları koru
            setInterval(() => {
                if (videoCanvas) {
                    videoCanvas.width = 2560;
                    videoCanvas.height = 1440;
                }
            }, 1000);
        });
        
        window.addEventListener('resize', setupCanvas);
        
        // Analyser settings update
        function updateAnalyserSettings() {
            switch(waveMode) {
                case 'bass':
                case 'fire':
                    analyser.fftSize = 256;
                    analyser.smoothingTimeConstant = 0.6;
                    break;
                case 'spectrum':
                case 'nebula':
                    analyser.fftSize = 4096;
                    analyser.smoothingTimeConstant = 0.8;
                    break;
                case 'hologram':
                    analyser.fftSize = 2048;
                    analyser.smoothingTimeConstant = 0.7;
                    break;
                default:
                    analyser.fftSize = 1024;
                    analyser.smoothingTimeConstant = 0.8;
            }
            
            bufferLength = analyser.frequencyBinCount;
            dataArray = new Uint8Array(bufferLength);
            timeArray = new Uint8Array(bufferLength);
        }
        
        // Audio File Handler
        audioUpload.addEventListener('change', handleAudioFile);
        
        function handleAudioFile(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            loading.classList.add('active');
            
            // Eski sesi tamamen temizle
            cleanUpAudioSystem();
            
            // Yeni ses dosyasını yükle
            currentAudioUrl = URL.createObjectURL(file);
            audioElement.src = currentAudioUrl;
            audioTitle.textContent = file.name.substring(0, 30) + (file.name.length > 30 ? '...' : '');
            audioDuration.textContent = 'Yüksek kalitede işleniyor...';
            
            // Ses dosyası yüklendiğinde
            audioElement.addEventListener('canplaythrough', () => {
                const duration = audioElement.duration;
                const minutes = Math.floor(duration / 60);
                const seconds = Math.floor(duration % 60);
                audioDuration.textContent = `Süre: ${minutes}:${seconds.toString().padStart(2, '0')} • ${(file.size / (1024 * 1024)).toFixed(1)}MB`;
                
                audioInfo.classList.add('active');
                loading.classList.remove('active');
                
                playBtn.disabled = false;
                downloadBtn.disabled = false;
                
                initAudioSystem();
            }, { once: true });
            
            audioElement.addEventListener('error', () => {
                loading.classList.remove('active');
                alert('Ses dosyası yüklenemedi. Lütfen geçerli bir ses dosyası seçin.');
            }, { once: true });
        }
        
        // Audio sistemini temizle
        function cleanUpAudioSystem() {
            if (audioSource) {
                audioSource.disconnect();
                audioSource = null;
            }
            
            if (analyser) {
                analyser.disconnect();
                analyser = null;
            }
            
            if (audioContext && audioContext.state !== 'closed') {
                audioContext.close().catch(console.error);
                audioContext = null;
            }
            
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            audioElement.pause();
            audioElement.src = '';
            audioElement.currentTime = 0;
            
            if (currentAudioUrl) {
                URL.revokeObjectURL(currentAudioUrl);
                currentAudioUrl = null;
            }
            
            isPlaying = false;
            resetControls();
            
            particles = [];
            fireParticles = [];
            nebulaParticles = [];
        }
        
        // Image File Handler
        imageUpload.addEventListener('change', handleImageFile);
        
        function handleImageFile(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const fileSize = (file.size / 1024).toFixed(1);
            imageTitle.textContent = file.name.substring(0, 30) + (file.name.length > 30 ? '...' : '');
            imageSize.textContent = `${fileSize} KB • ${file.type.split('/')[1].toUpperCase()}`;
            imageInfo.classList.add('active');
            
            const reader = new FileReader();
            reader.onload = (event) => {
                if (centerImage.src.startsWith('blob:')) {
                    URL.revokeObjectURL(centerImage.src);
                }
                
                const img = new Image();
                img.onload = () => {
                    defaultCircle.style.display = 'none';
                    centerImage.src = img.src;
                    centerImage.style.display = 'block';
                    currentImage = img;
                };
                img.onerror = () => {
                    alert('Görsel yüklenemedi. Lütfen geçerli bir görsel dosyası seçin.');
                };
                img.src = event.target.result;
            };
            reader.onerror = () => {
                alert('Görsel okunamadı. Lütfen tekrar deneyin.');
            };
            reader.readAsDataURL(file);
        }
        
        // Background File Handler
        backgroundUpload.addEventListener('change', handleBackgroundFile);
        
        function handleBackgroundFile(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (event) => {
                const img = new Image();
                img.onload = () => {
                    backgroundImage = img;
                    backgroundTitle.textContent = file.name.substring(0, 30) + (file.name.length > 30 ? '...' : '');
                    backgroundInfo.classList.add('active');
                };
                img.onerror = () => {
                    alert('Arkaplan görseli yüklenemedi.');
                };
                img.src = event.target.result;
            };
            reader.onerror = () => {
                alert('Arkaplan görseli okunamadı.');
            };
            reader.readAsDataURL(file);
        }
        
        // Drag and Drop
        document.querySelectorAll('.upload-box').forEach(box => {
            box.addEventListener('dragover', (e) => {
                e.preventDefault();
                box.style.borderColor = '#00ff00';
                box.style.transform = 'translateY(-5px) scale(1.02)';
            });
            
            box.addEventListener('dragleave', () => {
                box.style.borderColor = 'rgba(255, 255, 255, 0.2)';
                box.style.transform = 'translateY(0) scale(1)';
            });
            
            box.addEventListener('drop', (e) => {
                e.preventDefault();
                box.style.borderColor = 'rgba(255, 255, 255, 0.2)';
                box.style.transform = 'translateY(0) scale(1)';
                
                if (e.dataTransfer.files.length) {
                    const file = e.dataTransfer.files[0];
                    if (file.type.startsWith('audio/')) {
                        audioUpload.files = e.dataTransfer.files;
                        handleAudioFile({ target: audioUpload });
                    } else if (file.type.startsWith('image/')) {
                        if (box.closest('label[for="imageUpload"]')) {
                            imageUpload.files = e.dataTransfer.files;
                            handleImageFile({ target: imageUpload });
                        } else {
                            backgroundUpload.files = e.dataTransfer.files;
                            handleBackgroundFile({ target: backgroundUpload });
                        }
                    }
                }
            });
        });
        
        // Audio System Initialization
        function initAudioSystem() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)({
                sampleRate: 48000,
                latencyHint: 'interactive'
            });
            
            audioSource = audioContext.createMediaElementSource(audioElement);
            analyser = audioContext.createAnalyser();
            
            updateAnalyserSettings();
            
            bufferLength = analyser.frequencyBinCount;
            dataArray = new Uint8Array(bufferLength);
            timeArray = new Uint8Array(bufferLength);
            
            audioSource.connect(analyser);
            analyser.connect(audioContext.destination);
            
            initWavePoints();
            initParticleSystems();
        }
        
        // Initialize Wave Points
        function initWavePoints() {
            wavePoints = [];
            extraPoints = [];
            const angleStep = (Math.PI * 2) / barsCount;
            
            for (let i = 0; i <= barsCount; i++) {
                wavePoints.push({
                    angle: i * angleStep,
                    currentAmplitude: 0,
                    smoothAmplitude: 0,
                    x: 0,
                    y: 0
                });
                
                if (i % 2 === 0) {
                    extraPoints.push({
                        angle: i * angleStep,
                        offset: Math.random() * Math.PI * 2,
                        speed: 0.5 + Math.random() * 1.5
                    });
                }
            }
        }
        
        // Initialize Particle Systems
        function initParticleSystems() {
            particles = [];
            fireParticles = [];
            nebulaParticles = [];
            
            // Normal particles
            for (let i = 0; i < 200; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 2,
                    vy: (Math.random() - 0.5) * 2,
                    radius: Math.random() * 3 + 1,
                    color: `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.7)`,
                    life: 1
                });
            }
            
            // Fire particles
            for (let i = 0; i < 100; i++) {
                fireParticles.push({
                    x: 0,
                    y: 0,
                    vx: (Math.random() - 0.5) * 4,
                    vy: -Math.random() * 6 - 2,
                    radius: Math.random() * 8 + 2,
                    color: `rgba(255, ${Math.random() * 100}, 0, 0.8)`,
                    life: 1
                });
            }
            
            // Nebula particles
            for (let i = 0; i < 150; i++) {
                nebulaParticles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: 0,
                    vy: 0,
                    radius: Math.random() * 15 + 5,
                    color: `rgba(${Math.random() * 100 + 155}, ${Math.random() * 100 + 155}, 255, 0.3)`,
                    life: 1,
                    pulse: Math.random() * Math.PI * 2
                });
            }
        }
        
        // Draw Visualizer - YENİ MODLAR İLE
        function drawVisualizer(timestamp) {
            if (!isPlaying || !analyser) {
                animationId = requestAnimationFrame(drawVisualizer);
                return;
            }
            
            const width = canvas.width / (window.devicePixelRatio * 1.5);
            const height = canvas.height / (window.devicePixelRatio * 1.5);
            
            // Temizleme
            ctx.clearRect(0, 0, width, height);
            
            // Arkaplan
            if (backgroundImage && backgroundImage.complete) {
                ctx.save();
                ctx.globalAlpha = 0.4;
                ctx.drawImage(backgroundImage, 0, 0, width, height);
                ctx.restore();
            }
            
            // Karanlık overlay
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, width, height);
            
            // Get frequency data
            analyser.getByteFrequencyData(dataArray);
            analyser.getByteTimeDomainData(timeArray);
            
            const centerX = width / 2;
            const centerY = height / 2;
            const circleRadius = Math.min(width, height) * 0.12;
            
            // Bass yoğunluğu ve BPM hesaplama
            let bassIntensity = 0;
            for (let i = 0; i < 20; i++) bassIntensity += dataArray[i];
            bassIntensity = bassIntensity / 20 / 255;
            
            // BPM detection
            if (bassIntensity > 0.6 && Date.now() - lastBeat > 300) {
                beatTimes.push(Date.now());
                if (beatTimes.length > 10) beatTimes.shift();
                
                if (beatTimes.length > 1) {
                    const intervals = [];
                    for (let i = 1; i < beatTimes.length; i++) {
                        intervals.push(beatTimes[i] - beatTimes[i-1]);
                    }
                    const avgInterval = intervals.reduce((a, b) => a + b) / intervals.length;
                    bpm = Math.round(60000 / avgInterval);
                    currentBPM.textContent = bpm;
                }
                lastBeat = Date.now();
            }
            
            // Circle scaling
            if (waveMode === 'pulse') {
                targetCircleScale = 1 + Math.sin(timestamp * 0.005) * 0.2 + bassIntensity * 0.3;
            } else {
                targetCircleScale = 1 + bassIntensity * 0.5;
            }
            
            circleScale += (targetCircleScale - circleScale) * 0.05;
            
            // Update wave points
            for (let i = 0; i < wavePoints.length; i++) {
                const point = wavePoints[i];
                
                let freqIndex;
                switch(waveMode) {
                    case 'fire':
                    case 'bass':
                        freqIndex = Math.floor((i * 40) / barsCount);
                        break;
                    case 'nebula':
                        freqIndex = Math.floor((i * bufferLength * 0.6) / barsCount);
                        break;
                    default:
                        freqIndex = Math.floor((i * bufferLength) / barsCount);
                }
                
                const amplitude = dataArray[freqIndex % bufferLength] / 255;
                
                point.smoothAmplitude += (amplitude - point.smoothAmplitude) * 0.08;
                point.currentAmplitude = point.smoothAmplitude;
                
                // DALGA BOYUTU KONTROLÜ (waveScale ile)
                const waveLength = circleRadius * circleScale + (point.currentAmplitude * circleRadius * waveScale);
                
                point.x = centerX + Math.cos(point.angle) * waveLength;
                point.y = centerY + Math.sin(point.angle) * waveLength;
            }
            
            // MODA ÖZEL ÇİZİMLER
            switch(waveMode) {
                case 'rgb':
                    drawRGBWave(timestamp, centerX, centerY, circleRadius);
                    break;
                case 'fire':
                    drawFireWave(timestamp, centerX, centerY, circleRadius);
                    break;
                case 'nebula':
                    drawNebulaWave(timestamp, centerX, centerY, circleRadius);
                    break;
                case 'hologram':
                    drawHologramWave(timestamp, centerX, centerY, circleRadius);
                    break;
                case 'pulse':
                    drawPulseWave(timestamp, centerX, centerY, circleRadius);
                    break;
                case 'cyber':
                    drawCyberWave(timestamp, centerX, centerY, circleRadius);
                    break;
                case 'liquid':
                    drawLiquidWave(timestamp, centerX, centerY, circleRadius);
                    break;
                case 'energy':
                    drawEnergyWave(timestamp, centerX, centerY, circleRadius);
                    break;
            }
            
            // Merkez daire
            const currentCircleRadius = circleRadius * circleScale;
            centerCircle.style.width = `${currentCircleRadius * 2}px`;
            centerCircle.style.height = `${currentCircleRadius * 2}px`;
            
            // Special effects based on mode
            if (waveMode === 'fire' && bassIntensity > 0.5) {
                createFireExplosion(centerX, centerY, currentCircleRadius, bassIntensity);
            }
            
            animationId = requestAnimationFrame(drawVisualizer);
        }
        
        // RGB Wave
        function drawRGBWave(timestamp, centerX, centerY, circleRadius) {
            ctx.beginPath();
            ctx.moveTo(wavePoints[0].x, wavePoints[0].y);
            
            for (let i = 1; i < wavePoints.length; i++) {
                const point = wavePoints[i];
                const prevPoint = wavePoints[i-1];
                
                const cpX = (prevPoint.x + point.x) / 2;
                const cpY = (prevPoint.y + point.y) / 2;
                
                ctx.quadraticCurveTo(prevPoint.x, prevPoint.y, cpX, cpY);
            }
            
            ctx.closePath();
            
            const time = timestamp * 0.001;
            const r = Math.sin(time * 1.5 + wavePoints[0].angle) * 127 + 128;
            const g = Math.sin(time * 2.0 + wavePoints[0].angle) * 127 + 128;
            const b = Math.sin(time * 2.5 + wavePoints[0].angle) * 127 + 128;
            
            const gradient = ctx.createRadialGradient(
                centerX, centerY, circleRadius * circleScale,
                centerX, centerY, circleRadius * circleScale * 3
            );
            
            gradient.addColorStop(0, `rgba(${r}, ${g}, ${b}, 0.9)`);
            gradient.addColorStop(0.5, `rgba(${r}, ${g}, ${b}, 0.4)`);
            gradient.addColorStop(1, `rgba(${r}, ${g}, ${b}, 0)`);
            
            ctx.fillStyle = gradient;
            ctx.fill();
            
            ctx.strokeStyle = `rgba(${redColor}, ${greenColor}, ${blueColor}, 0.9)`;
            ctx.lineWidth = 4;
            ctx.stroke();
            
            // Inner wave
            ctx.beginPath();
            for (let i = 0; i < wavePoints.length; i++) {
                const point = wavePoints[i];
                const innerRadius = circleRadius * circleScale + (point.currentAmplitude * circleRadius * waveScale * 0.7);
                const x = centerX + Math.cos(point.angle) * innerRadius;
                const y = centerY + Math.sin(point.angle) * innerRadius;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            
            ctx.strokeStyle = `rgba(255, 255, 255, 0.6)`;
            ctx.lineWidth = 2;
            ctx.stroke();
        }
        
        // Fire Wave
        function drawFireWave(timestamp, centerX, centerY, circleRadius) {
            ctx.beginPath();
            for (let i = 0; i < wavePoints.length; i++) {
                const point = wavePoints[i];
                const fireHeight = point.currentAmplitude * circleRadius * waveScale * 1.5;
                
                if (i === 0) {
                    ctx.moveTo(point.x, point.y + fireHeight);
                } else {
                    ctx.lineTo(point.x, point.y + fireHeight);
                }
            }
            ctx.closePath();
            
            const fireGradient = ctx.createRadialGradient(
                centerX, centerY, circleRadius * circleScale,
                centerX, centerY, circleRadius * circleScale * 4
            );
            
            fireGradient.addColorStop(0, 'rgba(255, 100, 0, 0.9)');
            fireGradient.addColorStop(0.5, 'rgba(255, 50, 0, 0.5)');
            fireGradient.addColorStop(1, 'rgba(255, 0, 0, 0)');
            
            ctx.fillStyle = fireGradient;
            ctx.fill();
            
            // Fire particles
            for (let particle of fireParticles) {
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.life -= 0.01;
                
                if (particle.life <= 0 || particle.y < -50) {
                    resetFireParticle(particle, centerX, centerY, circleRadius);
                }
                
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.radius * particle.life, 0, Math.PI * 2);
                ctx.fillStyle = particle.color;
                ctx.fill();
            }
        }
        
        // Nebula Wave
        function drawNebulaWave(timestamp, centerX, centerY, circleRadius) {
            for (let particle of nebulaParticles) {
                particle.pulse += 0.02;
                const pulseScale = 1 + Math.sin(particle.pulse) * 0.3;
                
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.radius * pulseScale, 0, Math.PI * 2);
                
                const nebulaGradient = ctx.createRadialGradient(
                    particle.x, particle.y, 0,
                    particle.x, particle.y, particle.radius * pulseScale
                );
                
                nebulaGradient.addColorStop(0, particle.color);
                nebulaGradient.addColorStop(1, 'rgba(100, 100, 255, 0)');
                
                ctx.fillStyle = nebulaGradient;
                ctx.fill();
            }
            
            // Nebula wave
            ctx.beginPath();
            for (let i = 0; i < wavePoints.length; i++) {
                const point = wavePoints[i];
                const nebulaRadius = circleRadius * circleScale + (point.currentAmplitude * circleRadius * waveScale * 2);
                const x = centerX + Math.cos(point.angle) * nebulaRadius;
                const y = centerY + Math.sin(point.angle) * nebulaRadius;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            
            ctx.strokeStyle = 'rgba(150, 150, 255, 0.7)';
            ctx.lineWidth = 3;
            ctx.stroke();
        }
        
        // Hologram Wave
        function drawHologramWave(timestamp, centerX, centerY, circleRadius) {
            ctx.beginPath();
            for (let i = 0; i < wavePoints.length; i += 2) {
                const point = wavePoints[i];
                if (i === 0) {
                    ctx.moveTo(point.x, point.y);
                } else {
                    ctx.lineTo(point.x, point.y);
                }
            }
            ctx.closePath();
            
            const hologramGradient = ctx.createLinearGradient(
                0, 0, canvas.width, canvas.height
            );
            hologramGradient.addColorStop(0, 'rgba(0, 255, 255, 0.6)');
            hologramGradient.addColorStop(0.5, 'rgba(255, 0, 255, 0.6)');
            hologramGradient.addColorStop(1, 'rgba(0, 255, 255, 0.6)');
            
            ctx.fillStyle = hologramGradient;
            ctx.fill();
            
            // Grid lines
            for (let i = 0; i < wavePoints.length; i += 10) {
                const point = wavePoints[i];
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(point.x, point.y);
                ctx.strokeStyle = 'rgba(0, 255, 255, 0.3)';
                ctx.lineWidth = 1;
                ctx.stroke();
            }
        }
        
        // Pulse Wave (kalp atışı)
        function drawPulseWave(timestamp, centerX, centerY, circleRadius) {
            const pulse = Math.sin(timestamp * 0.005) * 0.5 + 0.5;
            
            ctx.beginPath();
            for (let i = 0; i < wavePoints.length; i++) {
                const point = wavePoints[i];
                const pulseRadius = circleRadius * circleScale + 
                    (point.currentAmplitude * circleRadius * waveScale) +
                    (pulse * circleRadius * 0.5);
                
                const x = centerX + Math.cos(point.angle) * pulseRadius;
                const y = centerY + Math.sin(point.angle) * pulseRadius;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            
            const pulseGradient = ctx.createRadialGradient(
                centerX, centerY, circleRadius * circleScale,
                centerX, centerY, circleRadius * circleScale * 3
            );
            
            pulseGradient.addColorStop(0, 'rgba(255, 50, 50, 0.9)');
            pulseGradient.addColorStop(0.7, 'rgba(255, 100, 100, 0.4)');
            pulseGradient.addColorStop(1, 'rgba(255, 150, 150, 0)');
            
            ctx.fillStyle = pulseGradient;
            ctx.fill();
            
            ctx.strokeStyle = 'rgba(255, 100, 100, 0.8)';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // Pulse circles
            for (let i = 0; i < 3; i++) {
                const pulseTime = timestamp * 0.001 + i * 0.5;
                const pulseSize = (pulseTime % 2) * circleRadius * 2;
                
                if (pulseSize < circleRadius * 4) {
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, circleRadius * circleScale + pulseSize, 0, Math.PI * 2);
                    ctx.strokeStyle = `rgba(255, 100, 100, ${0.3 - pulseSize / (circleRadius * 10)})`;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            }
        }
        
        // Cyberpunk Wave
        function drawCyberWave(timestamp, centerX, centerY, circleRadius) {
            // Main wave with grid effect
            ctx.beginPath();
            for (let i = 0; i < wavePoints.length; i += 2) {
                const point = wavePoints[i];
                const cyberRadius = circleRadius * circleScale + 
                    (point.currentAmplitude * circleRadius * waveScale * 1.2);
                
                const x = centerX + Math.cos(point.angle) * cyberRadius;
                const y = centerY + Math.sin(point.angle) * cyberRadius;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            
            ctx.fillStyle = 'rgba(0, 255, 255, 0.2)';
            ctx.fill();
            
            // Grid lines
            ctx.strokeStyle = 'rgba(0, 255, 255, 0.6)';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Digital rain effect
            for (let i = 0; i < 50; i++) {
                const x = Math.random() * canvas.width;
                const y = (timestamp * 0.1 + i * 100) % canvas.height;
                
                ctx.fillStyle = 'rgba(0, 255, 0, 0.8)';
                ctx.font = '16px monospace';
                ctx.fillText('01', x, y);
            }
        }
        
        // Liquid Metal Wave
        function drawLiquidWave(timestamp, centerX, centerY, circleRadius) {
            // Metallic gradient wave
            ctx.beginPath();
            for (let i = 0; i < wavePoints.length; i++) {
                const point = wavePoints[i];
                const liquidRadius = circleRadius * circleScale + 
                    (point.currentAmplitude * circleRadius * waveScale * 1.5);
                
                const x = centerX + Math.cos(point.angle) * liquidRadius;
                const y = centerY + Math.sin(point.angle) * liquidRadius;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    const prevPoint = wavePoints[i-1];
                    const cpX = (prevPoint.x + x) / 2;
                    const cpY = (prevPoint.y + y) / 2;
                    ctx.quadraticCurveTo(prevPoint.x, prevPoint.y, cpX, cpY);
                }
            }
            ctx.closePath();
            
            const metalGradient = ctx.createLinearGradient(
                0, 0, canvas.width, canvas.height
            );
            metalGradient.addColorStop(0, 'rgba(150, 150, 150, 0.8)');
            metalGradient.addColorStop(0.5, 'rgba(200, 200, 200, 0.9)');
            metalGradient.addColorStop(1, 'rgba(100, 100, 100, 0.7)');
            
            ctx.fillStyle = metalGradient;
            ctx.fill();
            
            // Highlights
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.lineWidth = 2;
            ctx.stroke();
        }
        
        // Energy Field Wave
        function drawEnergyWave(timestamp, centerX, centerY, circleRadius) {
            // Energy field with particles
            for (let particle of particles) {
                particle.x += particle.vx;
                particle.y += particle.vy;
                
                if (particle.x < 0 || particle.x > canvas.width) particle.vx *= -1;
                if (particle.y < 0 || particle.y > canvas.height) particle.vy *= -1;
                
                // Connect particles with lines
                for (let other of particles) {
                    const dx = particle.x - other.x;
                    const dy = particle.y - other.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 100) {
                        ctx.beginPath();
                        ctx.moveTo(particle.x, particle.y);
                        ctx.lineTo(other.x, other.y);
                        ctx.strokeStyle = `rgba(0, 255, 255, ${0.2 - distance/500})`;
                        ctx.lineWidth = 1;
                        ctx.stroke();
                    }
                }
                
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2);
                ctx.fillStyle = particle.color;
                ctx.fill();
            }
            
            // Energy wave
            ctx.beginPath();
            for (let i = 0; i < wavePoints.length; i++) {
                const point = wavePoints[i];
                if (i === 0) {
                    ctx.moveTo(point.x, point.y);
                } else {
                    ctx.lineTo(point.x, point.y);
                }
            }
            ctx.closePath();
            
            ctx.strokeStyle = 'rgba(0, 255, 255, 0.7)';
            ctx.lineWidth = 3;
            ctx.stroke();
        }
        
        // Fire particle reset
        function resetFireParticle(particle, centerX, centerY, circleRadius) {
            const angle = Math.random() * Math.PI * 2;
            const distance = circleRadius * circleScale + Math.random() * 50;
            
            particle.x = centerX + Math.cos(angle) * distance;
            particle.y = centerY + Math.sin(angle) * distance;
            particle.vx = (Math.random() - 0.5) * 4;
            particle.vy = -Math.random() * 6 - 2;
            particle.radius = Math.random() * 8 + 2;
            particle.color = `rgba(255, ${Math.random() * 100}, 0, 0.8)`;
            particle.life = 1;
        }
        
        // Fire explosion effect
        function createFireExplosion(centerX, centerY, radius, intensity) {
            for (let i = 0; i < 10; i++) {
                fireParticles.push({
                    x: centerX + (Math.random() - 0.5) * radius,
                    y: centerY + (Math.random() - 0.5) * radius,
                    vx: (Math.random() - 0.5) * 20 * intensity,
                    vy: -Math.random() * 15 * intensity - 5,
                    radius: Math.random() * 15 * intensity + 5,
                    color: `rgba(255, ${Math.random() * 150}, 0, 0.9)`,
                    life: 1
                });
            }
        }
        
        // Controls
        playBtn.addEventListener('click', async () => {
            if (!audioElement.src) {
                alert('Lütfen önce bir ses dosyası yükleyin.');
                return;
            }
            
            if (!backgroundImage) {
                alert('Lütfen arkaplan görseli yükleyin.');
                return;
            }
            
            if (!currentImage) {
                alert('Lütfen merkez görsel yükleyin.');
                return;
            }
            
            if (!audioContext) {
                initAudioSystem();
            }
            
            if (audioContext && audioContext.state === 'suspended') {
                await audioContext.resume();
            }
            
            try {
                await audioElement.play();
                isPlaying = true;
                playBtn.disabled = true;
                pauseBtn.disabled = false;
                stopBtn.disabled = false;
                
                if (!animationId) {
                    animationId = requestAnimationFrame(drawVisualizer);
                }
            } catch (err) {
                console.error('Playback error:', err);
                alert('Ses oynatılamadı. Tarayıcı izni gerekebilir.');
            }
        });
        
        pauseBtn.addEventListener('click', () => {
            audioElement.pause();
            isPlaying = false;
            playBtn.disabled = false;
            pauseBtn.disabled = true;
        });
        
        stopBtn.addEventListener('click', () => {
            audioElement.pause();
            audioElement.currentTime = 0;
            isPlaying = false;
            resetControls();
            
            if (isRecording) {
                stopRecording();
            }
        });
        
        function resetControls() {
            playBtn.disabled = false;
            pauseBtn.disabled = true;
            stopBtn.disabled = true;
        }
        
        // Volume Control
        volumeSlider.addEventListener('input', () => {
            const volume = volumeSlider.value / 100;
            audioElement.volume = volume;
            volumeValue.textContent = `${volumeSlider.value}%`;
        });
        
        // GELİŞMİŞ MP4 Video Recording System
        downloadBtn.addEventListener('click', async () => {
            if (!audioElement.src) {
                alert('Lütfen önce bir ses dosyası yükleyin.');
                return;
            }
            
            if (!backgroundImage) {
                alert('Lütfen arkaplan görseli yükleyin.');
                return;
            }
            
            if (!currentImage) {
                alert('Lütfen merkez görsel yükleyin.');
                return;
            }
            
            if (isRecording) {
                stopRecording();
            } else {
                await startRecording();
            }
        });
        
        async function startRecording() {
            try {
                // Kayıttan önce kontrol
                if (!audioContext) {
                    initAudioSystem();
                }
                
                if (audioContext.state === 'suspended') {
                    await audioContext.resume();
                }
                
                // Audio'yu başlat
                audioElement.currentTime = 0;
                await audioElement.play();
                isPlaying = true;
                playBtn.disabled = true;
                pauseBtn.disabled = false;
                stopBtn.disabled = false;
                
                // Animasyonu başlat
                if (!animationId) {
                    animationId = requestAnimationFrame(drawVisualizer);
                }
                
                // Kayıt başlat
                isRecording = true;
                recordingIndicator.classList.add('active');
                downloadBtn.innerHTML = '<i class="fas fa-stop-circle"></i> Kaydı Durdur';
                downloadBtn.style.background = 'linear-gradient(135deg, #ef4444, #dc2626, #b91c1c)';
                
                // Video canvas'ı hazırla
                videoCanvas.width = 2560;
                videoCanvas.height = 1440;
                
                // Video stream oluştur
                const stream = videoCanvas.captureStream(60);
                
                // Audio context'ten audio stream al
                const audioDestination = audioContext.createMediaStreamDestination();
                audioSource.connect(audioDestination);
                
                // Audio stream'i video stream'e ekle
                stream.addTrack(audioDestination.stream.getAudioTracks()[0]);
                
                // Video için MediaRecorder ayarları
                const options = {
                    mimeType: 'video/webm;codecs=h264,opus',
                    videoBitsPerSecond: 25000000 // 25 Mbps
                };
                
                // Fallback için alternatif codec'ler
                if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                    options.mimeType = 'video/webm;codecs=vp9,opus';
                }
                
                if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                    options.mimeType = 'video/webm;codecs=vp8,opus';
                }
                
                if (!MediaRecorder.isTypeSupported(options.mimeType)) {
                    options.mimeType = 'video/webm';
                }
                
                mediaRecorder = new MediaRecorder(stream, options);
                videoChunks = [];
                
                // Video verisi geldiğinde
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        videoChunks.push(event.data);
                    }
                };
                
                // Kayıt tamamlandığında
                mediaRecorder.onstop = async () => {
                    const blob = new Blob(videoChunks, { type: options.mimeType });
                    
                    try {
                        // MP4'e dönüştür
                        const mp4Blob = await convertToMP4(blob);
                        const url = URL.createObjectURL(mp4Blob);
                        
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `emloxa_visualizer_${Date.now()}_1440p.mp4`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        
                        URL.revokeObjectURL(url);
                        
                        alert('🎬 1440p MP4 video başarıyla indirildi!');
                    } catch (error) {
                        console.error('MP4 conversion error:', error);
                        // WebM olarak kaydet
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `emloxa_visualizer_${Date.now()}_1440p.webm`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        
                        URL.revokeObjectURL(url);
                        
                        alert('🎬 1440p WebM video başarıyla indirildi!');
                    }
                };
                
                // Video çerçevelerini kaydet
                let lastFrameTime = 0;
                const frameInterval = 1000 / 60; // 60 FPS
                
                function captureFrame() {
                    if (!isRecording) return;
                    
                    const currentTime = Date.now();
                    if (currentTime - lastFrameTime >= frameInterval) {
                        // Video canvas'ına çiz
                        videoCtx.clearRect(0, 0, videoCanvas.width, videoCanvas.height);
                        
                        // Ana canvas'ın içeriğini video canvas'ına kopyala
                        videoCtx.drawImage(canvas, 
                            0, 0, canvas.width, canvas.height,
                            0, 0, videoCanvas.width, videoCanvas.height
                        );
                        
                        lastFrameTime = currentTime;
                    }
                    
                    requestAnimationFrame(captureFrame);
                }
                
                // Kaydı başlat
                mediaRecorder.start(100);
                captureFrame();
                
                alert('📹 1440p 60FPS video kaydı başladı! Şarkı bitince otomatik olarak kayıt duracak ve indirilecek.');
                
                // Şarkı bitince kaydı durdur
                audioElement.addEventListener('ended', () => {
                    if (isRecording) {
                        setTimeout(stopRecording, 1000);
                    }
                }, { once: true });
                
            } catch (error) {
                console.error('Kayıt hatası:', error);
                alert('Video kaydı başlatılamadı: ' + error.message);
                stopRecording();
            }
        }
        
        // MP4'e dönüştürme (basit simülasyon)
        async function convertToMP4(webmBlob) {
            return webmBlob; // Burada gerçek conversion yapılabilir
        }
        
        function stopRecording() {
            if (!isRecording || !mediaRecorder) return;
            
            isRecording = false;
            recordingIndicator.classList.remove('active');
            downloadBtn.innerHTML = '<i class="fas fa-video"></i> 1440p Kaydet';
            downloadBtn.style.background = '';
            
            if (mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
            }
            
            mediaRecorder = null;
            videoChunks = [];
        }
        
        // Clean up events
        audioElement.addEventListener('ended', () => {
            isPlaying = false;
            resetControls();
            if (isRecording) {
                stopRecording();
            }
        });
    </script>
</body>
</html>
